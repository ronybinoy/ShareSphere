{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShareSphere | Dashboard</title>
  <!-- Favicon -->
  <link rel="shortcut icon" href="{% static 'assets/img/svg/logo.svg' %}" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="{% static '/dashboard.css' %}">
  <!-- Custom styles -->
  <link rel="stylesheet" href="{% static 'assets/css/style.min.css' %}">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    .btn {
      border: none;
    }

    /* Define the border on hover */
    .btn:hover {
      border: 5px solid #CCCCCC;
      /* Use your preferred shade of gray */
    }

    /* Add a background color to the search bar */
    .text-grey {
      background-color: #ffffff;
      /* Choose your desired background color */
      border: 5px solid #616161;
      /* Add a border for better visibility */
      padding: 10px;
      font-size: 16px;
      transition: border-color 0.2s;
    }

    .text-grey::placeholder {
      color: #4c4b4b;
    }

    /* Hover Effect */
    .text-grey:hover {
      border-color: #007bff;
      /* Change border color on hover */
      background-color: #e0e0e0;
      /* Change background color on hover */
    }

    /* Focus Effect */
    .text-grey:focus {
      border-color: #007bff;
      box-shadow: 0 0 5px #007bff;
    }
  </style>
  <!-- <script>
    $(document).ready(function () {

      const fields = [
        { id: "#name", validate: validateName },
        { id: "#slug", validate: validateSlug },
      ];

      fields.forEach(field => {
        $(field.id).keyup(function () {
          field.validate();
        });

        validateFieldOnBlur(field.id, field.validate);
      });

      function checkFormValidity() {
        const isValid = fields.every(field => {
          const $field = $(field.id);
          const $errorSpan = $(field.errorSpan); // Use the errorSpan property
      
          return $field.val().trim() !== "" && $errorSpan.html() === "";
        });
      
        $("#saveRoomButton").prop("disabled", !isValid);
      }
      

      function validateFieldOnBlur(fieldId, validationFunction) {
        $(fieldId).blur(function () {
          validationFunction();
          checkFormValidity();
        });
      }

      // Form submission
      $("#addRoomForm").submit(function (event) {
        if (!$("#saveRoomButton").prop("disabled")) {
          // Form is valid, allow submission
          return true;
        } else {
          // Form is not valid, prevent submission
          event.preventDefault();
          return false;
        }
      });

      // Initial check for form validity
      checkFormValidity();

      function validateName() {
        const name = $("#name").val();
        if (name.trim() === "") {
          $("#nmspan").html("Enter the Username").css("color", "#ff2600");
        } else {
          $("#nmspan").html("");
        }
      }

      function validateSlug() {
        const name = $("#slug").val();
        const lettersWithSpaces = /^[A-Za-z\s]+$/;
        if (name.trim() === "") {
          $("#slspan").html("Enter the First Name").css("color", "#ff2600");
        } else if (!lettersWithSpaces.test(name)) {
          $("#slspan").html("First Name field required only alphabet characters with spaces").css("color", "#ff2600");
        } else {
          $("#slspan").html("");
        }
      }
    });
    // Wait for DOM to load
    document.addEventListener("DOMContentLoaded", function () {

      const slugInput = document.getElementById('slug');
      const slugError = document.getElementById('slug-error');

      // Attach input listener
      slugInput.addEventListener('input', checkSlug);

      function checkSlug() {

        // Get current slug value
        const slug = slugInput.value;

        // Make AJAX request
        $.ajax({
          url: '/check-slug/',
          data: {
            'slug': slug
          },
          success: function (result) {

            // Check response
            if (result.exists) {
              slugError.textContent = 'Slug already exists';
            } else {
              slugError.textContent = '';
            }

          }
        });

      }

    });

  </script> -->
  <script>
    $(document).ready(function () {
      const fields = [
        { id: "#name", validate: validateName, errorSpan: "#nmspan" },
        { id: "#slug", validate: validateSlug, errorSpan: "#slspan" },
      ];
    
      fields.forEach(field => {
        $(field.id).keyup(function () {
          field.validate();
        });
    
        validateFieldOnBlur(field.id, field.validate);
      });
    
      function checkFormValidity() {
        const isValid = fields.every(field => {
          const $field = $(field.id);
          const $errorSpan = $(field.errorSpan);
    
          return $field.val().trim() !== "" && $errorSpan.html() === "";
        });
    
        $("#saveRoomButton").prop("disabled", !isValid);
      }
    
      function validateFieldOnBlur(fieldId, validationFunction) {
        $(fieldId).blur(function () {
          validationFunction();
          checkFormValidity();
        });
      }
    
      // Form submission
      $("#addRoomForm").submit(function (event) {
        if (!$("#saveRoomButton").prop("disabled")) {
          // Form is valid, allow submission
          event.preventDefault(); // Prevent submission for this example
          console.log("Form is valid, you can submit it."); // Replace with your submission logic
        } else {
          // Form is not valid, prevent submission
          event.preventDefault();
          console.log("Form is not valid, submission prevented.");
        }
      });
    
      // Initial check for form validity
      checkFormValidity();
    
      function validateName() {
        const name = $("#name").val();
        if (name.trim() === "") {
            $("#nmspan").html("Enter the Room Name").css("color", "#ff2600");
        } else if (name.length < 2) {
            $("#nmspan").html("Room Name should be at least 2 characters long").css("color", "#ff2600");
        } else {
            $("#nmspan").html("");
        }
    }
    
    function validateSlug() {
        const slug = $("#slug").val();
        const slugPattern = /^[A-Za-z]+$/; // Only alphabets, no spaces
    
        if (slug.trim() === "") {
            $("#slspan").html("Enter the Slug").css("color", "#ff2600");
        } else if (slug.length < 2) {
            $("#slspan").html("Slug should be at least 2 characters long").css("color", "#ff2600");
        } else if (!slugPattern.test(slug)) {
            $("#slspan").html("Slug should contain only alphabet characters").css("color", "#ff2600");
        } else {
            $("#slspan").html("");
        }
    }
    
    });
    
    // Wait for DOM to load
    document.addEventListener("DOMContentLoaded", function () {
      const slugInput = document.getElementById('slug');
      const slugError = document.getElementById('slug-error');
    
      // Attach input listener
      slugInput.addEventListener('input', checkSlug);
    
      function checkSlug() {
        // Get current slug value
        const slug = slugInput.value;
    
        // Make AJAX request
        $.ajax({
          url: '/check-slug/',
          data: {
            'slug': slug
          },
          success: function (result) {
            // Check response
            if (result.exists) {
              slugError.textContent = 'Slug already exists';
            } else {
              slugError.textContent = '';
            }
          }
        });
      }
    });
    
  </script>
</head>


<body>
  <div class="layer"></div>
  <!-- ! Body -->
  <a class="skip-link sr-only" href="#skip-target">Skip to content</a>
  <div class="page-flex">
    <!-- ! Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-start">
        <div class="sidebar-head">
          <a href="/" class="logo-wrapper" title="Home">
            <span class="sr-only">Home</span>

            <div class="logo-text">
              <span class="logo-title">ShareSphere</span>
              <span class="logo-subtitle">Dashboard</span>
            </div>

          </a>
          <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
            <span class="sr-only">Toggle menu</span>
            <span class="icon menu-toggle" aria-hidden="true"></span>
          </button>
        </div>
        <div class="sidebar-body">
          <ul class="sidebar-body-menu">
            <li>
              <a class="show-users-btn" href="javascript:void(0);">
                <span class="icon user-3" aria-hidden="true"></span>Users
              </a>
            </li>
            <li>
              <a class="show-course-listing-btn" href="javascript:void(0);">
                <span class="icon document" aria-hidden="true"></span>Listing Requests
              </a>
            </li>
            <li>
              <a href="#" class="show-users-btn" id="addChatroomBtn">
                <span class="icon edit" aria-hidden="true"></span>
                Add Chatroom
              </a>
            </li>
            <li>
              <a class="show-users-btn" data-toggle="modal" data-target="#chatroomsModal"><span class="icon category"
                  aria-hidden="true"></span>Chatrooms</a>
            </li>

          </ul>
          <!-- <span class="system-menu__title">system</span>
          <ul class="sidebar-body-menu"> 
            <li>
              <a href="appearance.html"><span class="icon edit" aria-hidden="true"></span>Appearance</a>
            </li>
            <li>
              <a class="show-cat-btn" href="##">
                <span class="icon category" aria-hidden="true"></span>Extentions
                <span class="category__btn transparent-btn" title="Open list">
                  <span class="sr-only">Open list</span>
                  <span class="icon arrow-down" aria-hidden="true"></span>
                </span>
              </a>
              <ul class="cat-sub-menu">
                <li>
                  <a href="extention-01.html">Extentions-01</a>
                </li>
                <li>
                  <a href="extention-02.html">Extentions-02</a>
                </li>
              </ul>
            </li>

            {% comment %} <li>
              <a href="##"><span class="icon setting" aria-hidden="true"></span>Settings</a>
            </li> {% endcomment %}
          </ul> -->
        </div>
      </div>
      <div class="sidebar-footer">
        <a href="##" class="sidebar-user">
          <span class="sidebar-user-img">
            <picture>
              <source srcset="{% static 'assets/img/avatar/avatar-illustrated-02.webp' %}" type="image/webp"><img
                src="{% static 'assets/img/avatar/avatar-illustrated-02.png' %}" alt="User name">
            </picture>
          </span>
          <div class="sidebar-user-info">
            <span class="sidebar-user__title">{{ user.first_name }}</span>
            <span class="sidebar-user__subtitle">Moderator</span>
          </div>
        </a>
      </div>
    </aside>
    <div class="main-wrapper">
      <!-- ! Main nav -->
      <nav class="main-nav--bg">
        <div class="container main-nav">
          <div class="main-nav-start">
            <h2 class="main-title">Admin Dashboard</h2>
          </div>
          <div class="main-nav-end">
            <button class="theme-switcher gray-circle-btn" type="button" title="Switch theme">
              <span class="sr-only">Switch theme</span>
              <i class="sun-icon" data-feather="sun" aria-hidden="true"></i>
              <i class="moon-icon" data-feather="moon" aria-hidden="true"></i>
            </button>
            <div class="notification-wrapper">
              <button class="gray-circle-btn dropdown-btn" title="To messages" type="button">
                <span class="sr-only">To messages</span>
                <span class="icon notification active" aria-hidden="true"></span>
              </button>
              <ul class="users-item-dropdown notification-dropdown dropdown">
                <li>
                  <a href="##">
                    <div class="notification-dropdown-icon info">
                      <i data-feather="check"></i>
                    </div>
                    <div class="notification-dropdown-text">
                      <span class="notification-dropdown__title">System just updated</span>
                      <span class="notification-dropdown__subtitle">The system has been successfully upgraded. Read more
                        here.</span>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="##">
                    <div class="notification-dropdown-icon danger">
                      <i data-feather="info" aria-hidden="true"></i>
                    </div>
                    <div class="notification-dropdown-text">
                      <span class="notification-dropdown__title">The cache is full!</span>
                      <span class="notification-dropdown__subtitle">Unnecessary caches take up a lot of memory space and
                        interfere ...</span>
                    </div>
                  </a>
                </li>
                <li>
                  <a href="##">
                    <div class="notification-dropdown-icon info">
                      <i data-feather="check" aria-hidden="true"></i>
                    </div>
                    <div class="notification-dropdown-text">
                      <span class="notification-dropdown__title">New Subscriber here!</span>
                      <span class="notification-dropdown__subtitle">A new subscriber has subscribed.</span>
                    </div>
                  </a>
                </li>
                <li>
                  <a class="link-to-page" href="##">Go to Notifications page</a>
                </li>
              </ul>
            </div>
            <div class="nav-user-wrapper">
              <button href="##" class="nav-user-btn dropdown-btn" title="My profile" type="button">
                <span class="sr-only">My profile</span>
                <span class="nav-user-img">
                  <picture>
                    <source srcset="{% static 'assets/img/avatar/avatar-illustrated-02.webp' %}" type="image/webp"><img
                      src="{% static 'assets/img/avatar/avatar-illustrated-02.png' %}" alt="User name">
                  </picture>
                </span>
              </button>
              <ul class="users-item-dropdown nav-user-dropdown dropdown">
                <li><a href="##">
                    <i data-feather="user" aria-hidden="true"></i>
                    <span>Profile</span>
                  </a></li>

                <li><a class="danger" href="{% url 'logout' %}">
                    <i data-feather="log-out" aria-hidden="true"></i>
                    <span>Log out</span>
                  </a></li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
      <!-- ! Main -->
      <main class="main users chart-page" id="skip-target">

        <div id="users-content">
          <div class="container">

            <hr>
            <div class="row" id="outerdiv">
              <div class="col-lg-12" id="innerdiv">
                <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"
                  rel="stylesheet">
                <div class="container">
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="main-box clearfix">


                        <div class="row">

                          <div class="col-lg-12" id="innerdiv">
                            <div class="main-box clearfix">
                              <div class="row">
                                <div class="col-md-6">
                                  <input type="text" class="text-grey mb-3" id="user-search" placeholder="Search users🔎">
                                </div>
                                <div class="col-md-6">
                                  <div class="d-flex align-items-center">
                                    <label for="role-filter" class="me-2">Filter Users:</label>
                                    <select class="form-select" id="role-filter">
                                      <option value="all">All Users</option>
                                      <option value="migrant">Migrants</option>
                                      <option value="institute">Institutes</option>
                                    </select>
                                  </div>
                                </div>
                              </div>


                              <div class="table-responsive">
                                <table id="user-list-table" class="table table-striped user-list">
                                  <thead>
                                    <tr>
                                      <th><span>User ID</span></th> <!-- New header for User ID -->
                                      <th><span>User</span></th>
                                      <th><span>Created</span></th>
                                      <th class="text-left"><span>Status</span></th>
                                      <th><span>Email</span></th>
                                      <th>Action</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    {% for user in users %}
                                    <tr>
                                      <td>{{ user.id }}</td>
                                      <td>

                                        <a href="#" class="user-link">{{ user.first_name }} {{ user.last_name }}</a>
                                        <span
                                          class="user-subhead{% if user.is_migrant %} migrant-red {% elif user.is_institute %} institute-green {% endif %}">
                                          {% if user.is_migrant %}
                                          Migrant
                                          {% elif user.is_institute %}
                                          Institute
                                          {% endif %}
                                        </span>
                                      </td>
                                      <td>
                                        {{ user.date_joined|date:"Y/m/d" }}
                                      </td>
                                      <td class="text-center">
                                        {% if user.is_active %}
                                        <span class="label label-success">Active</span>
                                        {% else %}
                                        <span class="label label-default">Inactive</span>
                                        {% endif %}
                                      </td>
                                      <td>
                                        <a href="mailto:{{ user.email }}">{{ user.email }}</a>
                                      </td>
                                      <td style="width: 10%;">
                                        <!-- <a href="#" class="table-link edit-user" data-user-id="{{ user.id }}">
                                          <span class="fa-stack">
                                            <i class="fa fa-square fa-stack-2x"></i>
                                            <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
                                          </span>
                                        </a> -->

                                        {% if user.is_active %}
                                        <button class="btn btn-danger btn-toggle-status" data-user-id="{{ user.id }}"
                                          data-new-status="inactive">Inactive</button>
                                        {% else %}
                                        <button class="btn btn-success btn-toggle-status" data-user-id="{{ user.id }}"
                                          data-new-status="active">Active</button>
                                        {% endif %}
                                      </td>
                                    </tr>
                                    {% endfor %}
                                  </tbody>
                                </table>
                              </div>
                              <ul class="pagination pull-right">
                                <!-- Pagination links here -->
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="course-listing-content">
        </div>
      </main>
      <div class="modal fade" id="addRoomModal" tabindex="-1" role="dialog" aria-labelledby="addRoomModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addRoomModalLabel">Add Chatroom</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="addRoomForm">
                <div class="form-group">
                  <label for="name">Name:</label>
                  <input type="text" class="form-control mb-2" id="name" name="name"
                    style="border: 1px solid #ccc !important;">
                  <span id="nmspan" style="font-size: 12px;"></span>
                </div>
                <div class="form-group mt-4">
                  <label for="slug">Slug:</label>
                  <input type="text" class="form-control mb-2" id="slug" name="slug"
                    style="border: 1px solid #ccc !important;">
                    <p id="slug-error" style="font-size: 12px; color:#ff2600; margin: top 10px;"></p>
                  <span id="slspan" style="font-size: 12px;"></span>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal" id="close" aria-label="Close">
                <span aria-hidden="true">Close</span>
              </button>
              <input type="submit" class="btn btn-primary" id="saveRoomButton" value="save" disabled>
            </div>
          </div>
        </div>
      </div>

      <!-- ! Footer -->
      <footer class="footer">
        <div class="container footer--flex">
          <div class="footer-start">
            <p>2021 © ShareSphere - <a href="#" target="_blank" rel="noopener noreferrer">ShareSphere.com</a></p>
          </div>
          <ul class="footer-end">
            <li><a href="##">About</a></li>
            <li><a href="##">Support</a></li>
          </ul>
        </div>
      </footer>
    </div>
  </div>


  <!-- Modal for entering remarks -->
  <div class="modal fade" id="rejectCourseModal" tabindex="-1" aria-labelledby="rejectCourseModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form method="post" id="rejectCourseForm">
          {% csrf_token %}
          <input type="hidden" name="courseId" id="courseId" value="">
          <div class="modal-header">
            <h5 class="modal-title" id="rejectCourseModalLabel">Enter Remarks for Rejection</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="rejectRemarks">Remarks:</label>
              <textarea class="form-control" id="rejectRemarks" rows="4"
                placeholder="Enter remarks for rejection"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <input type="button" class="btn btn-danger" value="Reject" id="rejectCourseButton">
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="modal fade" id="chatroomsModal" tabindex="-1" role="dialog" aria-labelledby="chatroomsModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="chatroomsModalLabel">Chatrooms</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row">
            {% for room in room_data %}
            <div class="col-md-4">
              <div class="card mt-2">
                <div class="card-body ">
                  <span style="padding: 5px; border-radius: 3px; color: #fff;
                    {% if room.is_active %}background-color:#4ac784;{% else %}background-color:#db5c69; {% endif %}">
                    {{ room.is_active|yesno:"Active,Inactive"|lower }}
                  </span>
                  <h5 class="card-title mt-2 p-1">{{ room.name }}</h5>
                  <p class="card-text mt-2 p-1">{{ room.message_count }} messages</p>

                  <button class="btn btn-primary toggle-status mt-2 p-1 align-item-center"
                    data-room-id="{{ room.id }}">Toggle Status</button>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>


    $(document).ready(function () {
      // Get search input
      const searchInput = document.getElementById('user-search');

      // Add input event
      searchInput.addEventListener('input', filterUsers);

      function filterUsers() {

        // Get search value
        const searchTerm = searchInput.value.toLowerCase();

        // Get all table rows
        const rows = document.querySelectorAll('#user-list-table tbody tr');

        // Loop through rows
        rows.forEach(row => {

          // Get user name cell
          const nameCell = row.querySelector('.user-link');

          // If name doesn't match search term, hide row
          if (!nameCell.textContent.toLowerCase().includes(searchTerm)) {
            row.style.display = 'none';
          } else {
            row.style.display = '';
          }

        });

      }



      $('.toggle-status').on('click', function () {
        var roomId = $(this).data('room-id');
        toggleRoomStatus(roomId);
      });

      function toggleRoomStatus(roomId) {
        // Get the CSRF token from the cookie
        var csrftoken = getCookie('csrftoken');

        $.ajax({
          url: '/toggle_room_status/',
          method: 'POST',
          headers: { 'X-CSRFToken': csrftoken }, // Include the CSRF token in headers
          data: { room_id: roomId },
          success: function (data) {
            // Update the room status display or show a success message
            if (data.message) {
              // Toggle the "active" or "inactive" display based on the room status
              var statusText = $('.toggle-status[data-room-id="' + roomId + '"]').parents('.card-body').find('.status-text');
              if (statusText.text() === 'Active') {
                statusText.text('Inactive');
              } else {
                statusText.text('Active');
              }
            } else {
              alert('Error toggling room status.');
            }
          },
          error: function () {
            alert('Error toggling room status.');
          }
        });
      }

      // Function to get the CSRF token from cookies
      function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
            var cookie = $.trim(cookies[i]);
            // Search for the CSRF token name
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }
    });


  </script>





  <!-- Chart library -->
  <script src="{% static 'assets/plugins/chart.min.js' %}"></script>
  <!-- Icons library -->
  <script src="{% static 'assets/plugins/feather.min.js' %}"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>


  <script>

    $(document).ready(function () {
      // Show the Add Room modal when the "Add Chatroom" button is clicked
      $('#addChatroomBtn').on('click', function () {
        $('#addRoomModal').modal('show');
      });
      $('#close').click(function () {
        $('#addRoomModal').modal('hide');
      });

      // Handle the "Save" button click in the modal
      $('#saveRoomButton').on('click', function () {
        const name = $('#name').val();
        const slug = $('#slug').val();

        // Make an AJAX POST request to add the room
        $.ajax({
          url: '/add_room/',  // Use the URL you defined in your URL pattern
          method: 'POST',
          data: {
            name: name,
            slug: slug,
            csrfmiddlewaretoken: '{{ csrf_token }}',  // Include the CSRF token
          },
          success: function (response) {
            // Handle the success response
            $('#addRoomModal').modal('hide');
            // Add any success handling code here
          },
          error: function (error) {
            // Handle errors and show an error message if needed
            // Add error handling code here
          }
        });
      });
    });



    function toggleTheme() {
      const body = document.body;
      if (body.classList.contains('light-theme')) {
        body.classList.remove('light-theme');
        body.classList.add('dark-theme');
      } else {
        body.classList.remove('dark-theme');
        body.classList.add('light-theme');
      }
    }

    // Add a click event listener to your theme switcher button
    const themeSwitcher = document.querySelector('.theme-switcher');
    themeSwitcher.addEventListener('click', toggleTheme);

    $(document).ready(function () {

      $('.btn-toggle-status').click(function () {
        const userId = $(this).data('user-id');
        const newStatus = $(this).data('new-status');
        const buttonElement = $(this); // Store the button element to access it inside the AJAX success callback

        // Send an AJAX request to update the user's status
        $.ajax({
          url: `/update_user_status/${userId}/`, // URL to your update_user_status view
          method: 'POST',
          data: {
            status: newStatus,
            csrfmiddlewaretoken: "{{ csrf_token }}"
          },
          success: function (response) {
            // Handle success
            if (response.success) {
              // Update the user's status in the table
              if (newStatus === 'active') {
                // Show the "Inactive" button
                buttonElement.removeClass('btn-success').addClass('btn-danger').text('Inactive').data('new-status', 'inactive');
              } else {
                // Show the "Active" button
                buttonElement.removeClass('btn-danger').addClass('btn-success').text('Active').data('new-status', 'active');
              }

              // Reload the page after the status is updated
              location.reload();
            } else {
              console.error('User status update failed:', response.message);
            }
          },
          error: function (error) {
            console.error('Error:', error);
          }
        });
      });


      $('#users-content').show();
      $('#course-listing-content').hide();

      // Add click event listeners to the buttons in the sidebar
      $('.show-users-btn').click(function () {
        $('#users-content').show();
        $('#course-listing-content').hide();
      });

      $('.show-course-listing-btn').click(function () {
        loadCourseDetails(); // Fetch and display pending courses
        $('#users-content').hide();
        $('#course-listing-content').show();
      });
    });



    // Function to display the rejection modal
    function displayRejectCourseModal(courseId) {
      // Fetch the course details using AJAX or any other method
      const course = fetchCourseDetails(courseId); // Replace with your implementation to fetch course details

      // Update the modal content with course information
      $('#rejectCourseModalLabel').text(`Reject Course: ${course.courseName}`);
      $('#rejectRemarks').val(''); // Clear any previous remarks

      // Show the modal
      $('#rejectCourseModal').modal('show');

      // Attach an event listener to the Reject button inside the modal
      $('#rejectCourseButton').off('click').on('click', function () {
        const remarks = $('#rejectRemarks').val();
        // Call a function to handle course rejection with remarks
        rejectCourseWithRemarks(courseId, remarks);
        // Close the modal
        $('#rejectCourseModal').modal('hide');
      });
    }


    function rejectCourseWithRemarks(courseId, remarks) {
      $.ajax({
        url: `/reject_course/${courseId}/`,
        method: 'POST',
        data: {
          remarks: remarks,
          csrfmiddlewaretoken: "{{ csrf_token }}"
        },
        success: function (response) {
          // Handle success
          if (response.success) {
            // Remove the course card from the listing if it was rejected successfully
            $(`#course-card-${courseId}`).remove();
          } else {
            // Handle the case where rejection fails
            console.error('Course rejection failed:', response.message);
          }
        },
        error: function (error) {
          // handle error  
        }
      });

    }




    document.addEventListener("DOMContentLoaded", function () {
      const userListTable = document.getElementById("user-list-table");
      const roleFilter = document.getElementById("role-filter");

      roleFilter.addEventListener("change", function () {
        const selectedRole = roleFilter.value;

        // Make an AJAX request to the filtered_users view
        fetch(`/filtered_users/${selectedRole}/`)
          .then(response => response.json())
          .then(data => {
            const users = data.users;

            // Loop through the table rows and update the table
            const rows = userListTable.getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {
              const row = rows[i];
              const userId = parseInt(row.cells[0].textContent);

              // Check if the user ID exists in the received data
              const user = users.find(u => u.id === userId);
              if (user) {
                row.style.display = ""; // Show the row
              } else {
                row.style.display = "none"; // Hide the row
              }
            }
          })
          .catch(error => {
            console.error('Error:', error);
          });
      });
    });


    // Function to update the status of a course in the database
    function updateCourseStatus(courseId, status) {
      // Make an AJAX request to update the course status
      $.ajax({
        url: `/update_course_status/${courseId}/${status}/`, // Replace with the actual URL
        type: 'GET',
        dataType: 'json', // Specify JSON dataType
        success: function (data) {
          // Check if the status was updated successfully
          if (data.success) {
            // Remove the course card from the listing if it's no longer pending
            if (status !== 'pending') {
              // Find the course card by course ID and remove it
              $(`#course-card-${courseId}`).remove();
            }
          } else {
            console.error('Error updating course status:', data.message);
          }
        },
        error: function (error) {
          console.error('Error:', error);
        }
      });
    }

    // Function to load and display course details
    function renderCourseDataToHTML(courses) {
      const container = $('#course-listing-content');

      // Clear any existing content inside the container
      container.empty();

      if (courses.length > 0) {
        // Create a new row div for every 3 cards
        let rowDiv;
        courses.forEach((course, index) => {
          if (index % 3 === 0) {
            // Start a new row for every 3 cards
            rowDiv = $('<div>').addClass('row custom-margin-row');
          }

          // Create a course card template
          const courseCard = $('<div>')
            .addClass('col-lg-4 col-md-6 col-sm-12 mb-4')
            .attr('id', `course-card-${course.id}`); // Add unique ID to the course card

          const cardDiv = $('<div>').addClass('card course-card rounded-xl');




          const cardBodyDiv = $('<div>').addClass('card-body'); // Removed 'text-center'

          const button = $('<button>')
            .addClass('btn btn-warning mb-3')
            .prop('disabled', true)
            .text('Pending');
          const cardImage = $('<img>')
            .addClass('card-img-top') // Add any necessary classes
            .attr('src', course.thumbnail_image_url) // Set the image URL here
            .attr('alt', 'Image Alt Text'); // Set the alt text for accessibility

          // Append the image to the card body


          const courseTitle = $('<h5>')
            .addClass('card-title')
            .text(course.course_name);

          const courseMode = $('<p>')
            .addClass('card-text mb-2') // Added 'mb-2' for spacing
            .html(`<strong>Course Mode:</strong> ${course.course_mode}`);

          const courseType = $('<p>')
            .addClass('card-text mb-2') // Added 'mb-2' for spacing
            .html(`<strong>Course Type:</strong> ${course.course_type}`);

          const eligibility = $('<p>')
            .addClass('card-text mb-2') // Added 'mb-2' for spacing
            .html(`<strong>Eligibility:</strong> ${course.eligibility}`);

          const duration = $('<p>')
            .addClass('card-text mb-2') // Added 'mb-2' for spacing
            .html(`<strong>Duration:</strong> ${course.duration}`);

          const fees = $('<p>')
            .addClass('card-text mb-2') // Added 'mb-2' for spacing
            .html(`<strong>Fees per Semester:</strong> $${course.fees}`);

          const instituteName = $('<p>')
            .addClass('card-text mb-2') // Added 'mb-2' for spacing
            .html(`<strong>Institute Name:</strong> ${course.user.first_name}`);

          const approvalButton = $('<button>')
            .addClass('btn btn-success')
            .text('Approve')
            .on('click', function () {
              updateCourseStatus(course.id, 'approved'); // Call the updateCourseStatus function with 'approved'
            });

          const rejectionButton = $('<button>')
            .addClass('btn btn-danger ms-2')
            .text('Reject')
            .on('click', function () {
              displayRejectCourseModal(course.id);
            });



          // Append elements to the card
          cardBodyDiv.append(cardImage);
          cardBodyDiv.append(
            button,
            courseTitle,
            $('<hr>'),
            courseMode,
            courseType,
            eligibility,
            duration,
            fees,
            instituteName,
            $('<div>').append(approvalButton, rejectionButton) // Removed 'text-center'
          );

          cardDiv.append(cardBodyDiv);
          courseCard.append(cardDiv);

          // Append the course card to the current row
          rowDiv.append(courseCard);

          if ((index + 1) % 3 === 0 || index === courses.length - 1) {
            // If we've added 3 cards or reached the end of the list, append the row to the container
            container.append(rowDiv);
          }
        });
      } else {
        // Display a message if there are no pending courses
        const message = $('<p>').addClass('text-dark').text('There are no pending courses.');
        container.append(message);
      }
    }

    function loadCourseDetails() {
      $.ajax({
        url: '/pending_courses/', // Replace with the actual URL
        type: 'GET',
        dataType: 'json', // Specify JSON dataType
        success: function (data) {
          try {
            // Assuming the server sends a JSON array of course objects
            if (Array.isArray(data.courses)) {
              renderCourseDataToHTML(data.courses);
              $('#course-listing-content').show();
              $('#users-content').hide();
            } else {
              console.error('Invalid JSON response:', data);
            }
          } catch (error) {
            console.error('Error parsing JSON:', error);
          }
        },
        error: function (error) {
          console.error('Error:', error);
        }
      });
    }


    $(document).ready(function () {
      $('#users-content').show();
      $('#course-listing-content').hide();

      // Add click event listeners to the buttons in the sidebar
      $('.show-users-btn').click(function () {
        $('#users-content').show();
        $('#course-listing-content').hide();
      });

      $('.show-course-listing-btn').click(function () {
        loadCourseDetails(); // Fetch and display pending courses
        $('#users-content').hide();
        $('#course-listing-content').show();
      });
    });









    // Function to fetch course details (you need to implement this)
    function fetchCourseDetails(courseId) {
      // Replace this with your code to fetch course details by courseId
      // You might need to make an AJAX request to get the course information
      const course = {
        courseId: courseId,
        courseName: 'add remark here', // Replace with actual course name
      };
      return course;
    }
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- Custom scripts -->
  <script src="{% static 'assets/js/script.js' %}"></script>
  <script src="{% static 'dashboard.js' %}"></script>
</body>

</html>
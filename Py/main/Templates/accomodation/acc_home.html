{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Course Listings</title>
    <!-- Example for using Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link href="{% static '/home.css' %}" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/yourcode.js" crossorigin="anonymous"></script>

    <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" />

    <link rel="stylesheet" href="{% static 'assets/css/fontawesome.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/templatemo-edu-meeting.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/owl.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/lightbox.css' %}" />
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>

    <style>
        th {
            font-size: 15px;
            font-weight: 600;
        }

        td,
        button {
            font-size: 13px;
        }

        .btn-smaller {
            padding: 0.25rem 0.5rem;
            /* Adjust padding to make it smaller */
            font-size: 12px;
            /* Adjust font size to make it smaller */
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            display: block;
            margin: 0 auto;
            background-color: #4caf50;
            color: #fff;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
            transform: scale(1.1);
        }

        .checkbox {
            margin-right: 10px;
        }

        .property-image {
            height: 200px;
            /* set your desired height */
            width: 100%;
            /* 100% width to maintain responsiveness */
            object-fit: cover;
            /* maintain aspect ratio and cover the container */
        }
    </style>
</head>

<body>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <header>
        <nav class="navbar navbar-expand-lg p-2" style="background-color: rgb(226, 226, 226)">
            <div class="container-fluid">
                <h4 class="text-success">ShareSphere</h4>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse d-flex" id="navbarSupportedContent">
                    <ul class="navbar-nav mb-lg-0 d-flex justify-content-lg-center w-100">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">Dashboard</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="#">Contact Us</a>
                        </li>
                    </ul>

                    {% if request.session.username %}
                    <ul class="navbar-nav mb-2 me-5 mb-lg-0 w-30 d-flex justify-content-lg-end ">
                        <li><i class="bi bi-person"></i>
                        </li>
                        <li class="nav-item dropdown ">
                            <a class="nav-link text-success" style="font-size: 30px; font-weight: bold;" href="#"
                                role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {{ request.session.username }}
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'logout' %}">Profile</a></li>
                                <li><a class="dropdown-item" href="{% url 'logout' %}">Log Out</a></li>
                            </ul>
                        </li>
                    </ul>
                    {% elif user.is_authenticated%}

                    <ul class="navbar-nav mb-2 me-5 mb-lg-0 w-50 d-flex justify-content-lg-end ">
                        <li>
                            <img src="{{ landlord_profile_photo.url }}" alt="Profile Photo"
                                class="img-thumbnail rounded-circle" style="max-width: 40px; max-height: 40px;">
                        </li>
                        <li class="nav-item dropdown ">
                            <a class="nav-link text-success" style="font-size: 20px; font-weight: bold;" href="#"
                                role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <p>{{ user.first_name }} {{ user.last_name }}</p>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a class="dropdown-item" href="#" onclick="openProfileModal()">
                                        Profile
                                    </a>
                                </li>
                                <li><a class="dropdown-item" href="{% url 'logout' %}">Log Out</a></li>
                            </ul>
                        </li>
                    </ul>

                    {% else %}
                    <ul class="navbar-nav mb-2 mb-lg-0 w-50 d-flex justify-content-lg-end">
                        <li class="nav-item dropdown">
                            <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <button class="btn btn-outline-success">Sign
                                    Up</button>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{%url 'signup' %}">Register as
                                        User</a></li>
                                <li><a class="dropdown-item" href="{% url 'inst_signup' %}">Register
                                        as Institute</a></li>
                                <li><a class="dropdown-item" href="{% url 'acc_signup' %}">Register
                                        as Landlord</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{%url 'login' %}" role="button" aria-expanded="false">
                                <button class="btn btn-outline-success">Log
                                    In</button>
                            </a>
                        </li>
                    </ul>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>

    <body>

        <div class="container-fluid">
            <div class="row">
                <div class="col-md-2" style="background-color: rgb(253, 253, 253);">
                    <div class="nav flex-column nav-pills mt-4" id="v-pills-tab" role="tablist"
                        aria-orientation="vertical">
                        <a class="nav-link active" id="v-pills-all-tab" data-toggle="pill" href="#v-pills-all"
                            role="tab" aria-controls="v-pills-all" aria-selected="false">Active Ads</a>
                        <a class="nav-link" id="v-pills-approved-tab" data-toggle="pill" href="#v-pills-approved"
                            role="tab" aria-controls="v-pills-approved" aria-selected="true"> Post Ads</a>
                        <a class="nav-link" id="v-pills-pending-tab" data-toggle="pill" href="#v-pills-pending"
                            role="tab" aria-controls="v-pills-pending" aria-selected="false"> Inactive Ads</a>
                        <a class="nav-link" id="v-pills-rejected-tab" data-toggle="pill" href="#v-pills-rejected"
                            role="tab" aria-controls="v-pills-rejected" aria-selected="false">Rejected Ads</a>
                    </div>
                </div>
                <div class="col-md-10">
                    <div class="tab-content" id="v-pills-tabContent">
                        <!-- all applications -->
                        <!-- property_list.html -->
                        <div class="tab-pane fade show active" id="v-pills-all" role="tabpanel"
                            aria-labelledby="v-pills-all-tab">
                            <div class="row mt-2">
                                {% for property in properties %}
                                {% if property.status == 'active' %}
                                <div class="col-md-4">
                                    <div class="card mb-3">
                                        <div class="row no-gutters">
                                            <div class="col-md-12">
                                                <img src="{{ property.frontview_image.url }}" class="card-img"
                                                    alt="Property Image">
                                                <div class="ms-3 mt-2">
                                                    <h5 class="card-title">{{ property.property_name }}</h5>
                                                    <p class="card-text"><small>{{ property.address }}</small></p>
                                                    <p class="card-text"><small>Rent per month <strong>${{ property.rent_per_month }}</strong></small></p>
                                                </div>
                                                <div class="card-body d-flex">
                                                    <input class="btn btn-primary view-btn me-2" type="button"
                                                        id="view-property" value="View" data-toggle="modal"
                                                        data-target="#propertyModal"
                                                        data-property-id="{{ property.id }}">
                                                    <input class="btn btn-secondary me-2 mark-inactive-btn" type="button"
                                                        value="Mark as Inactive" data-property-id="{{ property.id }}"
                                                        data-status="{{ property.status }}">

                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                {% endfor %}

                            </div>
                        </div>
                        <script>
                            $(document).ready(function () {
                                $.ajaxSetup({
                                    headers: {
                                        'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val()
                                    }
                                });

                                $(".mark-inactive-btn").click(function () {
                                    // Get the property ID and status from data attributes
                                    var propertyId = $(this).data("property-id");
                                    var currentStatus = $(this).data("status");

                                    // Make an AJAX request to update the property status
                                    $.ajax({
                                        url: '/update_property_status/',
                                        type: 'POST',
                                        data: { 'property_id': propertyId, 'status': 'inactive' },  // Change 'inactive' based on your status values
                                        success: function (data) {
                                            location.reload();
                                            console.log("Property status updated to inactive successfully");
                                        },
                                        error: function () {
                                            // Handle error
                                            console.log("Error updating property status");
                                        }
                                    });
                                });

                                $(".mark-active-btn").click(function () {
                                    var propertyId = $(this).data("property-id");

                                    $.ajax({
                                        url: '/update_property_status/',
                                        type: 'POST',
                                        data: {
                                            'property_id': propertyId,
                                            'status': 'pending'
                                        },
                                        success: function (data) {
                                            if (data.success) {
                                                console.log("Property status updated to active successfully");
                                                // Reload the page after updating status
                                                location.reload();
                                            } else {
                                                console.log("Failed to update property status");
                                            }
                                        },
                                        error: function () {
                                            console.log("Error updating property status");
                                        }
                                    });
                                });
                            });



                        </script>




                        <!-- Approved Applications -->
                        <div class="tab-pane fade" id="v-pills-approved" role="tabpanel"
                            aria-labelledby="v-pills-approved-tab">
                            <div class="container" style="height: 80vh; overflow-y: auto;">
                                <h2 class="text-center">Property Rental Form</h2>
                                <hr>
                                <form method="post" action="{% url 'property_submit' %}" enctype="multipart/form-data"
                                    id="propertyForm">
                                    {% csrf_token %}



                                    <label for="pname">Property Name:</label>
                                    <input type="text" id="pname" name="pname" required>
                                    <span id="pnamespan" style="font-size: 12px;"></span>

                                    <!-- Address -->
                                    <label for="address">Address:</label>
                                    <textarea id="address" name="address" rows="4" required></textarea>
                                    <span id="addressspan" style="font-size: 12px;"></span>

                                    <label for="mlink">Property location link ( Gmap ):</label>
                                    <input type="text" id="mlink" name="mlink" required>
                                    <span id="mlinkspan" style="font-size: 12px;"></span>

                                    <!-- Country -->
                                    <label for="nation">Country:</label>
                                    <select class="form-control border mb-4 mt-2" id="nation" name="nation" required>
                                        <option value="">Select nation</option>
                                        <option value="Ireland">Ireland</option>
                                        <option value="Canada">Canada</option>
                                    </select>
                                    <span id="nationspan" style="font-size: 12px;"></span>


                                    <!-- State -->
                                    <label for="state">State/province:</label>
                                    <select class="form-control border mb-4 mt-2" id="region" name="region" required>
                                        <!-- This dropdown will be populated dynamically based on the selected country -->
                                    </select>
                                    <span id="statespan" style="font-size: 12px;"></span>


                                    <label for="city">City:</label>
                                    <select class="form-control border mb-4 mt-2" id="city" name="city" required>
                                        <!-- This dropdown will be populated dynamically based on the selected state/province -->
                                    </select>
                                    <span id="cityspan" style="font-size: 12px;"></span>


                                    <!-- Contact Number -->


                                    <!-- Photographs of Property (Multiple File Upload) -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="frontview">Front view of Property:</label>
                                            <input type="file" id="frontview" name="frontview" accept="image/*"
                                                required>
                                            <span id="frontviewspan" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="living">Living Room:</label>
                                            <input type="file" id="living" name="living" accept="image/*" required>
                                            <span id="livingspan" style="font-size: 12px;"></span>

                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="bedroom">Bedroom:</label>
                                            <input type="file" id="bedroom" name="bedroom" accept="image/*" required>
                                            <span id="bedroomspan" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="bathroom">Wash Room:</label>
                                            <input type="file" id="bathroom" name="bathroom" accept="image/*" required>
                                            <span id="bathroomspan" style="font-size: 12px;"></span>

                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="kitchen">Kitchen:</label>
                                            <input type="file" id="kitchen" name="kitchen" accept="image/*" required>
                                            <span id="kitchenspan" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="dining">Dining Room:</label>
                                            <input type="file" id="dining" name="dining" accept="image/*" required>
                                            <span id="diningspan" style="font-size: 12px;"></span>

                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="other1">other 1:</label>
                                            <input type="file" id="other1" name="other1" accept="image/*" required>
                                            <span id="other1span" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="other2">other 2:</label>
                                            <input type="file" id="other2" name="other2" accept="image/*" required>
                                            <span id="other2span" style="font-size: 12px;"></span>

                                        </div>
                                    </div>
                                

                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="duration">Minimum Duration of Rent:</label>
                                            <select id="duration" name="duration" required>
                                                <option value="1">1 month</option>
                                                <option value="2">2 months</option>
                                                <option value="3">3 months</option>
                                                <option value="4">4 months</option>
                                                <option value="5">5 months</option>
                                                <option value="6">6 months</option>
                                            </select>
                                            <span id="durationspan" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="bhk">Number of Bedrooms :</label>
                                            <select id="bhk" name="bhk" required>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                            <span id="bhkspan" style="font-size: 12px;"></span>

                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="rent">Total Sqft:</label>
                                            <input type="number" id="sqft" name="sqft" required min="100" max="5000">
                                            <span id="sqftspan" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="bth">Number of Bathrooms:</label>
                                            <select id="bth" name="bth" required>
                                                <option value="1">1 </option>
                                                <option value="2">2 </option>
                                                <option value="3">3 </option>
                                                <option value="4">4 </option>
                                                <option value="5">5 </option>
                                            </select>
                                            <span id="bthspan" style="font-size: 12px;"></span>

                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="contact">Contact Number(include country code):</label>
                                            <input type="tel" id="contact" name="contact"  required>
                                            <span id="contactspan" style="font-size: 12px;"></span>

                                        </div>
                                        <div class="col-md-6">
                                            <label for="rent">Rent per Month:</label>
                                            <input type="text" id="rent" name="rent" required>
                                            <span id="rentspan" style="font-size: 12px;"></span>

                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <h5 class="mb-3">Additional Features:</h5>
                                        <div class="col-md-6">

                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="Parea" name="Parea">
                                                <label class="form-check-label" for="Parea">Parking Area</label>
                                                <span id="Pareaspan" style="font-size: 12px;"></span>

                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="cctv" name="cctv">
                                                <label class="form-check-label" for="cctv">CCTV</label>
                                                <span id="cctvspan" style="font-size: 12px;"></span>

                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="heater"
                                                    name="heater">
                                                <label class="form-check-label" for="heater">Heater</label>
                                                <span id="heaterspan" style="font-size: 12px;"></span>

                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="ac" name="ac">
                                                <label class="form-check-label" for="ac">Air Conditioning</label>
                                                <span id="acspan" style="font-size: 12px;"></span>

                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="pback" name="pback">
                                                <label class="form-check-label" for="pback">Power Backup</label>
                                                <span id="pbackspan" style="font-size: 12px;"></span>

                                            </div>
                                            <div class="form-check">
                                                <input type="checkbox" class="form-check-input" id="wifi" name="wifi">
                                                <label class="form-check-label" for="furniture">Wifi</label>
                                                <span id="wifispan" style="font-size: 12px;"></span>

                                            </div>
                                        </div>
                                    </div>

                                    <!-- Submit Button -->
                                    <button type="submit" id="submitBtn">Submit</button>

                                    <script>
                                        function displayErrorMessage(fieldId, message) {
                                            $(`${fieldId}span`).html(message);
                                        }
                                        
                                        $(document).ready(function () {
                                            const fields = [
                                                { id: "#pname", validate: validatePropertyname },
                                                { id: "#address", validate: validateAddress },
                                                { id: "#mlink", validate: validateMapLink },
                                                { id: "#nation", validate: validateCountry },
                                                { id: "#region", validate: validateState },
                                                { id: "#frontview", validate: validateFile },
                                                { id: "#living", validate: validateFile },
                                                { id: "#bedroom", validate: validateFile },
                                                { id: "#bathroom", validate: validateFile },
                                                { id: "#kitchen", validate: validateFile },
                                                { id: "#dining", validate: validateFile },
                                                { id: "#other1", validate: validateFile },
                                                { id: "#other2", validate: validateFile },
                                                { id: "#duration", validate: validateDuration },
                                                { id: "#bhk", validate: validateBHK },
                                                { id: "#bth", validate: validateBTH },
                                                { id: "#rent", validate: validateRent },
                                                { id: "#sqft", validate: validateSqft },
                                                { id: "#contact", validate: validatePhno},
                                            ];
                                            const validationStatus = {};

                                            fields.forEach(field => {
                                                $(field.id).keyup(function () {
                                                    field.validate();
                                                    validationStatus[fieldId] = $(`${fieldId}span`).html() === "";  
                                                    checkFormValidity();
                                                });

                                                validateFieldOnBlur(field.id, field.validate);
                                            });

                                            function checkFormValidity() {
                                                const isValid = Object.values(validationStatus).every(status => status);

                                                $("#submitBtn").prop("disabled", !isValid);
                                            }

                                            function validateFieldOnBlur(fieldId, validationFunction) {
                                                $(fieldId).blur(function () {
                                                    validationFunction();
                                                    validationStatus[fieldId] = $(`${fieldId}span`).html() === "";  
                                                });
                                            }

                                            // Form submission
                                            $("#propertyForm").submit(function (event) {
                                                if (!$("#submitBtn").prop("disabled")) {
                                                    // Form is valid, allow submission
                                                    return true;
                                                } else {
                                                    // Form is not valid, prevent submission
                                                    event.preventDefault();
                                                    return false;
                                                }
                                            });

                                            checkFormValidity();
                                        
                                            function validatePropertyname() {
                                                const pname = $("#pname").val();

                                                if (pname.trim() === "") {
                                                    displayErrorMessage("#pname", "Enter the Property Name");
                                                } else if (pname.length > 20) {
                                                    displayErrorMessage("#pname", "Property Name cannot exceed 20 characters");
                                                } else if (!/^[a-zA-Z0-9\s]+$/.test(pname)) {
                                                    displayErrorMessage("#pname", "Property Name can only contain letters, numbers, and spaces");
                                                } else {
                                                    $("#pnamespan").html("");
                                                }
                                            }

                                            function validateAddress() {
                                                const address = $("#address").val();

                                                if (address.trim() === "") {
                                                    displayErrorMessage("#address", "Enter the Property Address");
                                                } else if (address.length < 10) {
                                                    displayErrorMessage("#address", "Address should be at least 10 characters long");
                                                } else if (address.length > 255) {
                                                    displayErrorMessage("#address", "Address cannot exceed 255 characters");
                                                } else {
                                                    $("#addressspan").html("");
                                                }
                                            }


                                            function validateMapLink() {
                                                const mapLink = $("#mlink").val();

                                                if (mapLink.trim() === "") {
                                                    displayErrorMessage("#mlink", "Enter the Property location link");
                                                } else if (!mapLink.startsWith("https://maps.app.goo")) {
                                                    displayErrorMessage("#mlink", "Enter a valid Google Maps location link");
                                                } else {
                                                    $("#mlinkspan").html("");
                                                }
                                            }



                                            function validateCountry() {
                                                const country = $("#nation").val();
                                                if (country.trim() === "") {
                                                    displayErrorMessage("#nation", "Select the Country");
                                                } else {
                                                    $("#nationspan").html("");
                                                }
                                            }

                                            function validateState() {
                                                const state = $("#region").val();
                                                if (state.trim() === "") {
                                                    displayErrorMessage("#region", "Select the State/Province");
                                                } else {
                                                    $("#statespan").html("");
                                                }
                                            }

                                            function validateFile() {
                                                const fileInput = $(this)[0];
                                                const fieldName = $(this).attr("name");

                                                if (!fileInput.files || fileInput.files.length === 0) {
                                                    displayErrorMessage(`#${fieldName}`, `Upload a ${fieldName} image`);
                                                } else {
                                                    const allowedFormats = ["image/jpeg", "image/jpg", "image/png"];
                                                    const file = fileInput.files[0];

                                                    if (!allowedFormats.includes(file.type)) {
                                                        displayErrorMessage(`#${fieldName}`, `Invalid image format. Supported formats: JPEG, JPG, PNG`);
                                                    } else {
                                                        $(`#${fieldName}span`).html("");
                                                    }
                                                }
                                            }

                                            function validateDuration() {
                                                const duration = $("#duration").val();

                                                if (duration.trim() === "") {
                                                    displayErrorMessage("#duration", "Choose minimum duration");
                                                } else {
                                                    $("#durationspan").html("");
                                                }
                                            }

                                            function validateSqft() {
                                                const sqft = $("#sqft").val();
                                                if (sqft.trim() === "") {
                                                    displayErrorMessage("#sqft", "Enter square feet");
                                                } else if (!Number.isInteger(Number(sqft))) {
                                                    displayErrorMessage("#sqft", "Square feet must be an integer");
                                                } else {
                                                    const sqftValue = parseInt(sqft);
                                                    if (sqftValue < 100 || sqftValue > 10000) {
                                                        displayErrorMessage("#sqft", "Square feet must be between 100 and 10000");
                                                    } else {
                                                        $("#sqftspan").html("");
                                                    }
                                                }
                                            }
                                            

                                            function validateBHK() {
                                                const bhk = $("#bhk").val();
                                                if (bhk.trim() === "") {
                                                    displayErrorMessage("#bhk", "Select the Number of Bedrooms ");
                                                } else {
                                                    $("#bhkspan").html("");
                                                }
                                            }

                                            function validateBTH() {
                                                const bth = $("#bth").val();
                                                if (bth.trim() === "") {
                                                    displayErrorMessage("#bth", "Select the Number of Bathrooms ");
                                                } else {
                                                    $("#bthspan").html("");
                                                }
                                            }

                                            function validatePhno() {
                                                const ph = $("#contact").val();
                                                const filterIreland = /^\+353\d{9}$/;
                                                const filterCanada = /^\+1\d{10}$/;   
                                            
                                                if (ph === "") {
                                                    $("#contactspan").html("Enter the Contact Number").css("color", "#41586B");
                                                } else if (!filterIreland.test(ph) && !filterCanada.test(ph)) {
                                                    $("#contactspan").html("Enter a valid Contact Number for Ireland or Canada").css("color", "#41586B");
                                                } else {
                                                    $("#contactspan").html("");
                                                }
                                            }
                                            


                                            function validateRent() {
                                                const rent = $("#rent").val();
                                                if (rent.trim() === "") {
                                                    displayErrorMessage("#rent", "Enter the Rent per Month");
                                                } else if (!Number.isInteger(Number(rent))) {
                                                    displayErrorMessage("#rent", "Rent must be an integer");
                                                } else {
                                                    const rentValue = parseInt(rent);
                                                    if (rentValue < 50 || rentValue > 20000) {
                                                        displayErrorMessage("#rent", "Rent must be between 50 and 20000");
                                                    } else {
                                                        $("#rentspan").html("");
                                                    }
                                                }
                                            }
                                            

                                            function validateForm() {
                                                return fields.every(field => {
                                                    const $field = $(field.id);
                                                    const $errorSpan = $(`${field.id}span`);

                                                    if ($field.val().trim() === "" || $errorSpan.html() !== "") {
                                                        return false;
                                                    }
                                                    return true;
                                                });
                                            }
                                        });
                                    </script>
                                </form>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="v-pills-pending" role="tabpanel"
                            aria-labelledby="v-pills-pending-tab">
                            <div class="row mt-2">
                                {% if inactive_properties %}
                                {% for property in inactive_properties %}
                                <div class="col-md-4">
                                    <div class="card mb-3">
                                        <div class="row no-gutters">
                                            <div class="col-md-12">
                                                <img src="{{ property.frontview_image.url }}" class="card-img"
                                                    alt="Property Image">
                                                <div class="ms-3 mt-2">
                                                    <h5 class="card-title">{{ property.property_name }}</h5>
                                                    <p class="card-text"><small>{{ property.address }}</small></p>
                                                    <p class="card-text"><small>Rent per month <strong>${{ property.rent_per_month }}</strong></small></p>
                                                </div>
                                                <div class="card-body d-flex">
                                                    <input class="btn btn-success view-btn me-2" type="button"
                                                        id="view-property" value="View" data-toggle="modal"
                                                        data-target="#propertyModal"
                                                        data-property-id="{{ property.id }}">
                                                    <input class="btn btn-primary me-2 mark-active-btn" type="button"
                                                        value="Mark as Active" data-property-id="{{ property.id }}"
                                                        data-status="{{ property.status }}">
                                                        <input class="btn btn-secondary" type="button" value="Edit" data-toggle="modal" data-target="#editPropertyModal">
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <p>No Inactive properties to display.</p>
                            {% endif %}
                                
                            </div>
                        </div>
                        <!-- Rejected Applications -->
                        <div class="tab-pane fade" id="v-pills-rejected" role="tabpanel" aria-labelledby="v-pills-rejected-tab">
                            
                            <div class="row mt-2">
                                {% if rejected_properties %}
                                    {% for property in rejected_properties %}
                                        <div class="col-md-4">
                                            <div class="card mb-3">
                                                <div class="row no-gutters">
                                                    <div class="col-md-12">
                                                        <img src="{{ property.frontview_image.url }}" class="card-img" alt="Property Image">
                                                        <div class="ms-3 mt-2">
                                                            <h5 class="card-title">{{ property.property_name }}</h5>
                                                            <p class="card-text"><small>{{ property.address }}</small></p>
                                                            <p class="card-text"><small>Rent per month <strong>${{ property.rent_per_month }}</strong></small></p>
                                                            {% if property.rejection_remark %}
                                                                <p class="card-text text-danger"><strong>Rejection Remark:</strong> {{ property.rejection_remark }}</p>
                                                            {% endif %}
                                                        </div>
                                                        <div class="card-body d-flex">
                                                            <input class="btn btn-success view-btn me-2" type="button"
                                                                id="view-property" value="View" data-toggle="modal"
                                                                data-target="#propertyModal" data-property-id="{{ property.id }}">
                                                            <!-- Add other buttons as needed -->
                                                            <input class="btn btn-secondary" type="button" value="Edit" data-toggle="modal" data-target="#editPropertyModal">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    {% endfor %}
                                {% else %}
                                    <p>No rejected properties to display.</p>
                                {% endif %}
                                
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFILE UPDATE MODAL -->
        <div class="modal fade" id="profileModal" tabindex="-1" role="dialog" aria-labelledby="profileModalTitle"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-center" id="profileModalTitle">Profile</h5>
                    </div>
                    <div class="modal-body">
                        <!-- Edit Profile Photo Section -->
                        <form id="profileForm" method="POST" action="{% url 'acc_home' %}"
                            enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="text-center mb-3">
                                <img src="{{ profile_photo_url }}" alt="Profile Photo"
                                    class="img-thumbnail rounded-circle" style="max-width: 150px;" id="profileImage">
                                <br>
                                <button type="button" class="btn btn-link mt-2" id="editProfilePhotoButton">Edit Profile
                                    Photo</button><br>
                                <input type="file" class="form-control-file d-none" id="profile_photo"
                                    name="profile_photo">
                            </div>
                            <div class="form-group">
                                <label for="first_name">First Name</label>
                                <input type="text" class="form-control" id="first_name" value="{{ user.first_name }}"
                                    name="first_name" pattern="[a-zA-Z]{3,}" placeholder="Eg: John" required>
                                <div class="invalid-feedback">
                                    First name must contain only alphabetic characters and have a minimum length of 3
                                    characters.
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="last_name">Last Name</label>
                                <input type="text" class="form-control" id="last_name" value="{{ user.last_name }}"
                                    name="last_name" pattern="[a-zA-Z]{3,}" placeholder="Eg: Doe" required>
                                <div class="invalid-feedback">
                                    Last name must contain only alphabetic characters and have a minimum length of 3
                                    characters.
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="dob">Date of Birth</label>
                                {% if user.landlord.dob %}
                                <input type="text" class="form-control" id="dob" value="{{ user.landlord.dob }}"
                                    name="dob" readonly>
                                {% else %}
                                <input type="date" class="form-control" id="dob"
                                    value="{{ user.landlord.dob|date:'Y-m-d' }}" name="dob" required>
                                <span id="dateOfBirthError" class="text-danger"></span>
                                <div class="invalid-feedback">
                                    Date of birth is required.
                                    
                                </div>
                                {% endif %}
                            </div>
                            <div class="form-group">
                                <label for="contact_no">Contact Number</label>
                                <input type="tel" class="form-control" id="contact_no"
                                    value="{{ user.landlord.contact_no }}" name="contact_no" pattern="[1-9][0-9]{9}"
                                    required>
                                <div class="invalid-feedback">
                                    Contact number must start with a digit from 1 to 9 and contain a total of 10 digits.
                                </div>
                            </div>
                            <input type="hidden" name="user_id" value="{{ user.id }}">
                            <input type="hidden" name="landlord_id" value="{{ user.landlord.id }}">

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <div class="modal fade" id="propertyModal" tabindex="-1" role="dialog" aria-labelledby="propertyModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-center" id="propertyModalLabel">Property Details</h5>
                </div>
                <div class="modal-body" id="propertyDetails">
                    <div class="row">
                        <div class="col-md-6">
                            <img src="" class="img-fluid frontview-image" alt="Front View">
                        </div>
                        <div class="col-md-6">
                            <h5 class="property-name"></h5>
                            <p><strong>Address:</strong> <span class="address"></span></p>
                            <p><strong>Country:</strong> <span class="country"></span></p>
                            <p><strong>State/Province:</strong> <span class="state-province"></span></p>
                            <p><strong>Contact Number:</strong> <span class="contact-number"></span></p>
                            <p><strong>Rent Per Month:</strong> <span class="rent-per-month"></span></p>
                            <p><strong>Minimum Duration of Rent:</strong> <span class="min-duration-of-rent"></span></p>
                            <p><strong>Number of Bedrooms:</strong> <span class="num-bedrooms"></span></p>
                            <p><strong>Parking Area:</strong> <span class="parking-area"></span></p>
                            <p><strong>CCTV:</strong> <span class="cctv"></span></p>
                            <p><strong>Heater:</strong> <span class="heater"></span></p>
                            <p><strong>Air Conditioning:</strong> <span class="air_conditioning"></span></p>
                            <p><strong>Power Backup:</strong> <span class="power_backup"></span></p>
                            <p><strong>Wifi:</strong> <span class="wifi"></span></p>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-4">
                            <img src="" class="img-fluid living-room-image" alt="Living Room">
                            <p class="text-center"><strong>Living Room</strong></p>
                        </div>
                        <div class="col-md-4">
                            <img src="" class="img-fluid bedroom-image" alt="Bedroom">
                            <p class="text-center"><strong>Bedroom</strong></p>
                        </div>
                        <div class="col-md-4">
                            <img src="" class="img-fluid bathroom-image" alt="Bathroom">
                            <p class="text-center"><strong>Bathroom</strong></p>
                        </div>
                        <div class="col-md-4">
                            <img src="" class="img-fluid kitchen_image" alt="kitchen">
                            <p class="text-center"><strong>kitchen</strong></p>
                        </div>
                        <div class="col-md-4">
                            <img src="" class="img-fluid dining_room_image" alt="Dining Room">
                            <p class="text-center"><strong>Dining Room</strong></p>
                        </div>
                        <div class="col-md-4">
                            <img src="" class="img-fluid other1_image" alt="Additional facilities">
                            <p class="text-center"><strong>Additional facilities</strong></p>
                        </div>
                        <div class="col-md-4">
                            <img src="" class="img-fluid other2_image" alt="Additional facilities">
                            <p class="text-center"><strong>Additional facilities</strong></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>




    <!-- Add this script at the end of your HTML file or in a separate script file -->
    <script>
        $(document).ready(function () {
            // Handle the click event on the "View" button
            $(".view-btn").click(function () {
                // Get the property ID from the data-property-id attribute
                var propertyId = $(this).data("property-id");

                // Make an AJAX request to retrieve the property details
                $.ajax({
                    url: '/get_property_details/',
                    type: 'GET',
                    data: { 'property_id': propertyId },
                    success: function (data) {
                        // Update the modal content with the retrieved details
                        $(".property-name").text(data.property_name);
                        $(".address").text(data.address);
                        $(".country").text(data.country);
                        $(".state-province").text(data.state_province);
                        $(".contact-number").text(data.contact_number);
                        $(".rent-per-month").text('$' + data.rent_per_month);
                        $(".min-duration-of-rent").text(data.minimum_duration_of_rent);
                        $(".num-bedrooms").text(data.number_of_bedrooms);
                        $(".parking-area").text(data.parking_area ? 'Yes' : 'No');
                        $(".cctv").text(data.cctv ? 'Yes' : 'No');
                        $(".heater").text(data.heater ? 'Yes' : 'No');
                        $(".air_conditioning").text(data.air_conditioning ? 'Yes' : 'No');
                        $(".power_backup").text(data.power_backup ? 'Yes' : 'No');
                        $(".wifi").text(data.wifi ? 'Yes' : 'No');

                        // Update photo sources and add the property-image class
                        $("#propertyDetails .col-md-6 img.frontview-image").attr("src", data.frontview_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.living-room-image").attr("src", data.living_room_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.bedroom-image").attr("src", data.bedroom_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.bathroom-image").attr("src", data.bathroom_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.kitchen_image").attr("src", data.kitchen_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.dining_room_image").attr("src", data.dining_room_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.other1_image").attr("src", data.other1_image).addClass("property-image");
                        $("#propertyDetails .col-md-4 img.other2_image").attr("src", data.other2_image).addClass("property-image");

                        // Display the modal
                        $('#propertyModal').modal('show');
                    },
                    error: function () {
                        // Handle error
                        console.log("Error retrieving property details");
                    }
                });

                // Remove the modal backdrop on modal close
                $('#propertyModal').on('hidden.bs.modal', function () {
                    $('.modal-backdrop').remove();
                });
            });
        });




        //modal for edit info

        



        document.addEventListener('DOMContentLoaded', function () {
            var myTabs = new bootstrap.Tab(document.getElementById('v-pills-all-tab'));
            myTabs.show();
        });


        function openProfileModal() {
            $('#profileModal').modal('show');
        }
        document.addEventListener('DOMContentLoaded', function () {
            const editProfilePhotoButton = document.getElementById('editProfilePhotoButton');
            const profilePhotoInputDiv = document.getElementById('profilePhotoInputDiv');

            editProfilePhotoButton.addEventListener('click', function () {
                // Toggle the visibility of the "Choose file" input field
                if (profilePhotoInputDiv.style.display === 'none') {
                    profilePhotoInputDiv.style.display = 'block';
                } else {
                    profilePhotoInputDiv.style.display = 'none';
                }
            });

        });

        document.addEventListener('DOMContentLoaded', function () {
            const editProfilePhotoButton = document.getElementById('editProfilePhotoButton');
            const profilePhotoInput = document.getElementById('profile_photo');
            const dobInput = document.getElementById('dob');
            const firstNameInput = document.getElementById('first_name');
            const lastNameInput = document.getElementById('last_name');
            const contactNoInput = document.getElementById('contact_no');

            editProfilePhotoButton.addEventListener('click', function () {
                profilePhotoInput.classList.remove('d-none');
            });

            // Add change event listeners for validation
            firstNameInput.addEventListener('change', validateFirstName);
            lastNameInput.addEventListener('change', validateLastName);
            contactNoInput.addEventListener('change', validateContactNo);
            dobInput.addEventListener('change', validateDateOfBirth);

            function validateFirstName() {
                const regex = /^[a-zA-Z]{3,}$/;
                if (!regex.test(firstNameInput.value)) {
                    firstNameInput.setCustomValidity('First name must contain only alphabetic characters and have a minimum length of 3 characters.');
                } else {
                    firstNameInput.setCustomValidity('');
                }
            }

            function validateLastName() {
                const regex = /^[a-zA-Z]{3,}$/;
                if (!regex.test(lastNameInput.value)) {
                    lastNameInput.setCustomValidity('Last name must contain only alphabetic characters and have a minimum length of 3 characters.');
                } else {
                    lastNameInput.setCustomValidity('');
                }
            }

            function validateContactNo() {
                const regex = /^[1-9][0-9]{9}$/;
                if (!regex.test(contactNoInput.value)) {
                    contactNoInput.setCustomValidity('Contact number must start with a digit from 1 to 9 and contain a total of 10 digits.');
                } else {
                    contactNoInput.setCustomValidity('');
                }
            }

            function validateDateOfBirth() {
                const dob = dobInput.value;
                if (dob.trim() === "") {
                    dobInput.setCustomValidity('Date of birth is required.');
                } else {
                    // Convert the input date to the expected format (YYYY-MM-DD)
                    const selectedDate = new Date(dob);
                    const year = selectedDate.getFullYear();
                    const month = String(selectedDate.getMonth() + 1).padStart(2, '0'); // Add 1 to the month because it's zero-based
                    const day = String(selectedDate.getDate()).padStart(2, '0');

                    const formattedDate = `${year}-${month}-${day}`;

                    // Update the input value with the formatted date
                    dobInput.value = formattedDate;

                    const currentDate = new Date();
                    const age = currentDate.getFullYear() - selectedDate.getFullYear();
                    if (age < 13) {
                        dobInput.setCustomValidity('You must be at least 13 years old.');
                    } else {
                        dobInput.setCustomValidity('');
                    }
                }
            }

        });





// Define dropdown elements
// Define dropdown elements
const nationDropdown = document.getElementById('nation');
const regionDropdown = document.getElementById('region');
const cityDropdown = document.getElementById('city');

// Define country regions and their cities
const countryRegions = {
    'Ireland': [
        'Connacht',
        'County Carlow',
        'County Cavan',
        'County Clare',
        'County Cork',
        'County Donegal',
        'County Dublin',
        'County Galway',
        'County Kerry',
        'County Kildare',
        'County Kilkenny',
        'County Laois',
        'County Limerick',
        'County Longford',
        'County Louth',
        'County Mayo',
        'County Meath',
        'County Monaghan',
        'County Offaly',
        'County Roscommon',
        'County Sligo',
        'County Tipperary',
        'County Waterford',
        'County Westmeath',
        'County Wexford',
        'County Wicklow',
        'Leinster',
        'Munster',
        'Ulster',
    ],
    'Canada': [
        'Alberta',
        'British Columbia',
        'Manitoba',
        'New Brunswick',
        'Newfoundland and Labrador',
        'Northwest Territories',
        'Nova Scotia',
        'Nunavut',
        'Ontario',
        'Prince Edward Island',
        'Quebec',
        'Saskatchewan',
        'Yukon'
    ],
    // Add more countries and their regions here
};

// Define cities for each state/province
const stateCities = {
    'Connacht': [
        'Galway',
        'Leitrim',
        'Mayo',
        'Roscommon',
        'Sligo'
    ],
    'County Carlow': [
        'Carlow'
    ],
    'County Cavan': [
        'Cavan'
    ],
    'County Clare': [
        'Clare'
    ],
    'County Cork': [
        'Cork'
    ],
    'County Donegal': [
        'Donegal'
    ],
    'County Dublin': [
        'Dublin'
    ],
    'County Galway': [
        'Galway'
    ],
    'County Kerry': [
        'Kerry'
    ],
    'County Kildare': [
        'Kildare'
    ],
    'County Kilkenny': [
        'Kilkenny'
    ],
    'County Laois': [
        'Laois'
    ],
    'County Limerick': [
        'Limerick'
    ],
    'County Longford': [
        'Longford'
    ],
    'County Louth': [
        'Louth'
    ],
    'County Mayo': [
        'Mayo'
    ],
    'County Meath': [
        'Meath'
    ],
    'County Monaghan': [
        'Monaghan'
    ],
    'County Offaly': [
        'Offaly'
    ],
    'County Roscommon': [
        'Roscommon'
    ],
    'County Sligo': [
        'Sligo'
    ],
    'County Tipperary': [
        'Tipperary'
    ],
    'County Waterford': [
        'Waterford'
    ],
    'County Westmeath': [
        'Westmeath'
    ],
    'County Wexford': [
        'Wexford'
    ],
    'County Wicklow': [
        'Wicklow'
    ],
    'Leinster': [
        'Carlow',
        'Dublin',
        'Kildare',
        'Kilkenny',
        'Laois',
        'Longford',
        'Louth',
        'Meath',
        'Offaly',
        'Westmeath',
        'Wexford',
        'Wicklow'
    ],
    'Munster': [
        'Clare',
        'Cork',
        'Kerry',
        'Limerick',
        'Tipperary',
        'Waterford'
    ],
    'Ulster': [
        'Cavan',
        'Donegal',
        'Monaghan'
    ],
    'Alberta': [
        'Calgary',
        'Edmonton',
        'Red Deer'
    ],
    'British Columbia': [
        'Vancouver',
        'Victoria',
        'Kelowna'
    ],
    'Manitoba': [
        'Winnipeg',
        'Brandon'
    ],
    'New Brunswick': [
        'Fredericton',
        'Moncton',
        'Saint John'
    ],
    'Newfoundland and Labrador': [
        'St. John\'s',
        'Mount Pearl',
        'Corner Brook'
    ],
    'Northwest Territories': [
        'Yellowknife',
        'Inuvik'
    ],
    'Nova Scotia': [
        'Halifax',
        'Dartmouth',
        'Sydney'
    ],
    'Nunavut': [
        'Iqaluit',
        'Rankin Inlet'
    ],
    'Ontario': [
        'Toronto',
        'Ottawa',
        'Mississauga'
    ],
    'Prince Edward Island': [
        'Charlottetown',
        'Summerside'
    ],
    'Quebec': [
        'Montreal',
        'Quebec City',
        'Laval'
    ],
    'Saskatchewan': [
        'Saskatoon',
        'Regina',
        'Prince Albert'
    ],
    'Yukon': [
        'Whitehorse'
    ]
};

// Function to populate the region dropdown based on the selected country
function populateRegionDropdown() {
    const selectedCountry = nationDropdown.value;
    regionDropdown.innerHTML = '<option value="">Select State or Province</option>';
    if (selectedCountry in countryRegions) {
        countryRegions[selectedCountry].forEach(region => {
            const option = document.createElement('option');
            option.value = region;
            option.textContent = region;
            regionDropdown.appendChild(option);
        });
    }
}

// Function to populate the city dropdown based on the selected state/province
function populateCityDropdown() {
    const selectedRegion = regionDropdown.value;
    cityDropdown.innerHTML = '<option value="">Select City</option>';
    if (selectedRegion in stateCities) {
        stateCities[selectedRegion].forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            cityDropdown.appendChild(option);
        });
    }
}

// Attach event listeners
nationDropdown.addEventListener('change', populateRegionDropdown);
regionDropdown.addEventListener('change', populateCityDropdown);

// Initial population of dropdowns
populateRegionDropdown();
populateCityDropdown();


    </script>

    <!-- Add Bootstrap JS scripts at the end of the body if needed -->
    <!-- Add Bootstrap JS scripts at the end of the body if needed -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>

</html>